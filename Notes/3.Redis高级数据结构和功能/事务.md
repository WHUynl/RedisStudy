# 事务

### 简介

Redis提供了简单的事务功能，该功能主要由multi命令和exec命令实现：

1. **multi命令代表事务的开始，exec命令代表事务的结束**，它们之间的命令按顺序执行； 
2.  当客户端执行multi命令之后，它就进入了事务模式，这时**用户输入的所有命令会按顺序放入一个事务队列中；** 
3.  当客户端执行exec命令之后，它才执行当前事务，执行成功后它会按照命令入队顺序返回各个命令的执行结果； 
4. 若要**取消事务，使用discard代替exec命令即可**，它会清空事务队列中已有的命令，并让客户端退出事务模式。

**注意**

说Redis提供的是简单的事务，主要体现在两个方面： 

1. Redis事务**不支持回滚**,即取消事务不会导致已改变的数值的退回； 
2. Redis事务总是支持ACID中的**ACI特性**，当它运行**在特定的持久化模式下时，也支持D特性**。

### 带乐观锁的事务

很多时候，**要确保事务中的数据没有被其他客户端修改才执行该事务**： 

1. Redis提供了**watch命令来解决这类问题**，这是一种乐观锁的机制； 
2. 客户端通过watch命令，要求**服务器对一个或多个key进行监视，如果在客户端执行事务之前，这些key发生 了变化，则服务器将拒绝执行客户端提交的事务，并向它返回一个空值**。