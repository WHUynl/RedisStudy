# Redis持久化性能调优

### 改善fork操作的耗时

执行RDB持久化或AOF重写时，**都需要通过fork操作创建子进程**，对于大多数操作系统来说fork是重量级操作。 

可以从以下几个方面，改善fork操作的耗时： 

1. **优先使用物理机**，或者高效支持fork操作的虚拟化技术，避免使用Xen； 
2. **控制Redis实例的最大可用内存，fork耗时跟内存量成正比**，线上建议每个实例的内存控制在10GB以内； 
3. 降低fork操作的频率，如适度**放宽AOF自动触发时机，避免不必要的全量复制**。

### 优化子进程的开销

◼ CPU 

1. Redis是CPU密集型服务，**不要做绑定单核CPU操作**； 
2. **不要和其他CPU密集型服务部署在一起**，造成CPU过度竞争； 
3. 如果部署多个Redis实例，**尽量保证同一时刻只有一个子进程在工作**；

 ◼ 内存 

1. **避免在大量写入时执行重写操作**，这将导致父进程维护大量的页副本； 
2. 如果部署多个Redis实例，尽量保证同一时刻只有一个子进程在工作；

 ◼ 硬盘 

1. 不要和其他高硬盘负载的服务部署在一起； 
2. 可以开启配置“no-appendfsync-on-rewrite”，表示在重写期间不做fsync操作； 
3. 对于单机配置多个Redis实例的情况，**可以配置不同实例分盘存储AOF文件，分摊硬盘写入压力**。

###  AOF追加阻塞

![](pic\14.png)